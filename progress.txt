# Fullstack Blog - Progress Log

## Task 1: 后端项目初始化 ✅
- Express + TypeScript + Prisma + MariaDB 后端项目搭建完成
- 配置：tsconfig.json（strict mode）、.env、CORS、rate limiting
- 入口文件 src/index.ts，数据库连接 src/config/db.ts
- scripts: dev（nodemon）、build（tsc）、start

## Task 2: 前端项目初始化 ✅
- React 19 + Vite 7 + TypeScript + Tailwind CSS 4 项目创建完成
- 安装 react-router-dom、axios、react-markdown、react-syntax-highlighter
- src/lib/api.ts 封装 API 请求，src/types/index.ts 定义类型
- vite.config.ts 配置 /api 代理到后端 5000 端口

## Task 3: 数据库模型设计 ✅
- Prisma schema 定义 Category、Tag、Article、ArticleTag 四个模型
- Article 全文索引（title + content），slug 唯一索引
- src/scripts/seed.ts 种子数据：3 个分类 + 5 个标签

## Task 4: 分类 CRUD API ✅
- GET/POST/PUT/DELETE /api/categories 全部实现
- Zod schema 校验 + apiKeyAuth 中间件保护写操作

## Task 5: 标签 CRUD API ✅
- GET/POST/PUT/DELETE /api/tags 全部实现
- Zod schema 校验 + apiKeyAuth 中间件保护写操作

## Task 6: 文章 CRUD API ✅
- GET/POST/PUT/DELETE /api/articles 全部实现
- 分页、按分类/标签筛选、自动生成 slug、浏览量统计
- 事务更新 Tag/Category 的 articleCount

## Task 7: 搜索 API ✅
- GET /api/search?q=keyword 全文搜索实现
- 支持按标签、分类筛选，分页返回

## Task 8: 前端布局和导航 ✅
- Header（导航 + 搜索框 + 移动端菜单）
- Sidebar（分类列表 + 标签云 + 移动端可折叠）
- Footer + Layout 整体布局

## Task 9: 文章列表页 ✅
- HomePage 文章列表 + 骨架屏加载 + 空状态提示
- ArticleCard 文章卡片（封面、分类、标签、操作按钮）
- Pagination 分页组件（省略号 + 上下页）

## Task 10: 文章详情页 ✅
- ArticlePage 使用 react-markdown 渲染 + Prism 代码高亮
- 显示元信息：日期、分类、标签、浏览量、草稿状态
- 编辑/删除操作 + 确认弹窗

## Task 11: Markdown 编辑器 ✅
- MarkdownEditor 编辑/预览双模式切换
- 工具栏 11 个格式化按钮（加粗、斜体、标题、链接、代码块等）
- Tab 缩进支持，光标位置插入

## Task 12: 创建/编辑文章页 ✅
- CreateArticlePage + EditArticlePage 复用 ArticleForm
- 表单：标题、摘要、Markdown 编辑器、分类下拉、标签多选、封面图、发布开关
- 表单校验 + 提交后跳转详情页

## Task 13: 前端分类和标签管理 ✅
- CategoryPage + TagPage 按分类/标签筛选文章列表
- Sidebar 高亮当前选中分类/标签
- useArticleList 自定义 hook 复用筛选逻辑

## Task 14: 搜索功能前端 ✅
- SearchPage 搜索结果页 + 300ms 防抖
- 关键词高亮、URL 参数同步、空结果提示
- 骨架屏加载状态

## Task 15: 文章删除和状态管理 ✅
- Toast 通知组件（success/error/info，3 秒自动消失）
- ConfirmModal 确认弹窗（可自定义文案 + loading 状态）
- 文章详情页 + 列表页均支持删除操作

## Task 16: UI 美化和最终测试 ✅
- 统一配色（blue 主色 + gray 中性色）、圆角、阴影
- 全页面骨架屏加载状态
- 响应式布局：移动端菜单折叠、Sidebar 遮罩层

---

## Task 17: 用户模型与数据库迁移 ✅
- Prisma schema 新增 User 模型（username, email, password, role, status, createdAt, updatedAt）
- Article 模型新增 authorId 可空外键关联 User（onDelete: SetNull）
- 使用 prisma db push 同步数据库结构

---

## Task 23: 前端 AuthContext 与 API 改造 ✅
- types/index.ts 新增 User、UserRole、UserStatus、AuthResponse 类型
- 创建 src/contexts/AuthContext.tsx（AuthProvider + useAuth hook）
- api.ts 请求拦截器从 X-API-Key 切换到 Bearer token
- 新增 401 响应拦截器自动清除失效 token

## Task 18: 后端 JWT 认证中间件 ✅
- 安装 bcryptjs jsonwebtoken 及类型声明
- 创建 src/middleware/auth.ts：signToken、verifyToken、requireAuth、requireApproved、requireAdmin
- AuthPayload 接口 + Express Request 扩展
- .env 新增 JWT_SECRET
- TypeScript 编译通过

## 待完成：用户认证系统（Task 20-22, 26）

- Task 20: 用户管理 API（管理员）
- Task 21: 替换 API Key 为 JWT 认证
- Task 22: 种子数据：默认管理员账号
- Task 26: 导航栏与页面权限适配

## Task 19: 注册与登录 API ✅
- 创建 src/schemas/authSchema.ts（registerSchema、loginSchema Zod 校验）
- 创建 src/controllers/authController.ts（register、login、getMe）
- 创建 src/routes/authRoutes.ts（POST /register、POST /login、GET /me）
- index.ts 注册 authRoutes，CORS methods 添加 PATCH
- TypeScript 编译通过

## Task 24: 登录与注册页面 ✅
- 创建 ProtectedRoute 路由守卫组件（支持 requireApproved / requireAdmin）
- 创建 LoginPage（邮箱+密码表单，错误提示，登录成功跳转首页）
- 创建 RegisterPage（用户名+邮箱+密码表单，注册成功提示等待审核）
- App.tsx 用 AuthProvider 包裹，新增 /login、/register 路由
- /create 和 /edit/:slug 用 ProtectedRoute requireApproved 包裹

## Task 25: 管理员用户管理页面 ✅
- 创建 AdminUsersPage（用户列表表格，按状态筛选标签页）
- 支持审核通过/拒绝/删除用户操作（复用 ConfirmModal）
- App.tsx 新增 /admin/users 路由，用 ProtectedRoute requireAdmin 包裹
